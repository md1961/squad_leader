<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>SVG Background Image</title>

        <style>
            body {
                margin: 50px;
            }
            text {
                background-color: white;
            }
            .foreign-content {
                color: white;
                background-color: darkgreen;
                font-size: 10px;
                padding: 3px 3px;
            }
        </style>

        <script src="js/svg_element.js"></script>
        <script src="js/init.js" /></script>

        <script src="js/find_hex_from_coord.js" /></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const svg = document.getElementById("map");

                svg.addEventListener('click', (event) => {
                    // クリック位置をSVGの座標系に変換
                    const pt = svg.createSVGPoint();
                    pt.x = event.clientX;
                    pt.y = event.clientY;

                    const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                    const {x, y} = svgP;

                    console.log(`SVG座標: x=${x}, y=${y}`);

                    const elemCircle = new SvgElement('circle', {cx: x, cy: y, r: 2, fill: 'red'});
                    svg.appendChild(elemCircle.toDOM());

                    console.log(`hexName = ${findHexFromCoord(x, y)}`);
                });

                /*
                const [x1, y1] = coord("H4");
                const [x2, y2] = coord("K3");
                const elemLine = new SvgElement('line', {x1, y1, x2, y2, stroke: "black"});

                svg.appendChild(elemLine.toDOM());
                */
            });
        </script>
    </head>

    <body>
        <svg id="map" width="938" height="645" xmlns="http://www.w3.org/2000/svg">
            <image
                href="map001.png"
                x="0" y="0"
                width="938" height="645"
                preserveAspectRatio="none" />

            <foreignObject x="330" y="165" width="80" height="50">
                <div xmlns="http://www.w3.org/1999/xhtml">
                    <span id="mySpan" class="foreign-content">
                        6-2-8:3
                    </span>
                </div>
            </foreignObject>

            <!-- Rectangle, to anchor coordinate system -->
            <rect
                x="57" y="65" width="843" height="548"
                fill="rgba(0, 0, 255, 0)" stroke="black" stroke-width="0" />
        </svg>
    </body>
</html>
